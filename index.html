<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Demo Avatar Crop</title>
		<link href='https://fonts.googleapis.com/css?family=Damion' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="styles/style.css" charset="utf-8">
		<script type="text/javascript" src="dist/avatar-crop.full.min.js"></script>
	</head>
	<body>
		<section class="sections">
			<h1>Avatar Crop<br>
				<a class="github-button" href="https://github.com/edoardocavazza/avatar-crop" data-icon="octicon-star" data-style="mega" data-count-href="/edoardocavazza/avatar-crop/stargazers" data-count-api="/repos/edoardocavazza/avatar-crop#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star edoardocavazza/avatar-crop on GitHub">Star</a>
				<a class="github-button" href="https://github.com/edoardocavazza/avatar-crop/fork" data-icon="octicon-repo-forked" data-style="mega" data-count-href="/edoardocavazza/avatar-crop/network" data-count-api="/repos/edoardocavazza/avatar-crop#forks_count" data-count-aria-label="# forks on GitHub" aria-label="Fork edoardocavazza/avatar-crop on GitHub">Fork</a>
				<a class="github-button" href="https://github.com/edoardocavazza/avatar-crop/archive/master.zip" data-icon="octicon-cloud-download" data-style="mega" aria-label="Download edoardocavazza/avatar-crop on GitHub">Download</a>
			</h1>
		</section>
		<section class="sections">
			<h3>Drag &amp; drop or click!</h3>
			<!-- Place this tag where you want the button to render. -->

			<div class="holder" style="float: left;"></div>
			<input type="button" tabindex="1" name="fill" value="fill" onclick="avatar.fill().render()"><br>
			<input type="button" tabindex="1" name="fit" value="fit" onclick="avatar.fit().render()"><br>
			<input type="button" tabindex="1" name="center" value="center" onclick="avatar.center().render()"><br>
			<input type="button" tabindex="1" name="clear" value="clear" onclick="avatar.clear()">
		</section>
		<section class="sections filters">
			<h3>Apply a filter!</h3>
		</section>
		<section class="sections">
			<h3>Save or use!</h3>
			<a id="export" data-download="awesome-avatar.png">
				<img />
			</a>
		</section>
		<script type="text/javascript">
			var avatar = new AvatarCrop( document.querySelector('.holder') ),
					wrap = document.querySelector('.filters'),
					link = document.getElementById('export'),
					img = link.firstElementChild;

			function toggleFilter(name, conf) {
				if (avatar.data) {
					if (avatar.hasFilter(name)) {
						avatar.removeFilter(name).render();
					} else {
						avatar.addFilter(name, conf).render();
					}
				}
			}

			for (var k in AvatarCrop.filters) {
				wrap.innerHTML += (
					'<div class="filter" tabindex="2" aria-label="$FILTER" onclick="toggleFilter(\'$FILTER\')">' +
						'<div class="filter-holder" data-filter="$FILTER"></div>' +
						'<label for="$FILTER">$FILTER</label>' +
					'</div>'
				).replace(/\$FILTER/g, k);
			}

			var filters = document.querySelectorAll('.filter-holder'),
					filterAvatars = [];

			for (var i = 0, len = filters.length; i < len; i++) {
				filterAvatars[i] = new AvatarCrop(filters[i], {
					width: 128,
					height: 128,
					message: '',
					interactive: false,
					selectable: false,
					droppable: false
				});
			}

			var updateTimeout = null;

			function updateFilters() {
				var data = avatar.save();
				for (var i = 0, len = filters.length; i < len; i++) {
					var f = filters[i],
						name = f.getAttribute('data-filter'),
						av = filterAvatars[i],
						ctx = av.canvas.getContext('2d');
					if (data) {
						av.setSource(data);
						if (!avatar.hasFilter(name)) {
							av.addFilter(name).render();
							f.classList.remove('active');
						} else {
							f.classList.add('active');
						}
					} else {
						av.clear();
					}
				}
				if (data) {
					img.src = data;
					link.href = data;
					link.setAttribute('download', link.getAttribute('data-download'));
				} else {
					img.removeAttribute('src');
					link.removeAttribute('href');
					link.removeAttribute('download');
				}
			}

			avatar.addEventListener('change', updateFilters);
			avatar.addEventListener('clear', updateFilters);
		</script>
		<!-- Place this tag right after the last button or just before your close body tag. -->
		<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
	</body>
</html>
