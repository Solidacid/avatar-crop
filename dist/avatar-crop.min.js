!function(){function a(a){var b={};for(var c in a)b[c]=a[c];return b}function b(a,b,c){a.addEventListener(b,c,!1)}function c(a,b){a.removeEventListener(b)}function d(){var a=document.createElement("canvas");return a.style.border="solid 1px #DDD",a.style.backgroundColor="#FFF",a.style.backgroundImage='url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzIgMzIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxyZWN0IGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjxyZWN0IHg9IjE2IiB5PSIxNiIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+")',a.style.userSelect="none",a.style.webkitUserSelect="none",a}function e(a,b,c){this.name=a,this.fn=b,this.configs=c||{}}function f(a,b){if(!a)throw"Missing element.";this.canvas=d(),this._callbacks={},this.filters=[],this.config(b),a.appendChild(this.canvas),this.clear()}var g=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),h={interactive:!0,droppable:!0,selectable:!0,width:null,height:null,message:"Drop an image or click to select one.",minZoom:1,maxZoom:1/0};e.prototype.exec=function(a,b,c){return this.fn.call(this,a,b,c)},e.prototype.config=function(a){for(var b in a)this.configs[b]=a[b]};var i=f.prototype;f.DEFAULT_WIDTH=256,f.DEFAULT_HEIGHT=256,f.DEFAULT_WHEEL_FACTOR=100,f.DEFAULT_ANIM_DURATE=250,f.DEFAULT_MODE="fit",f.filters={},f.Filter=e,f.registerFilter=function(a,b,c){f.filters[a]={fn:b,defaults:c}},i.config=function(b){var c=a(this.options||{}),d=this.options||a(h);if(b)for(var e in b)"undefined"!=typeof d[e]&&(d[e]=b[e]);this.canvas&&(this.canvas.width=d.width||f.DEFAULT_WIDTH,this.canvas.height=d.height||f.DEFAULT_HEIGHT,d.interactive&&!c.interactive?this.bindInteractive():c.interactive&&this.unbindInteractive(),d.droppable&&!c.droppable?this.bindDroppable():c.droppable&&this.unbindDroppable(),d.selectable&&!c.selectable?this.bindSelectable():c.selectable&&this.unbindSelectable()),this.options=d},i.addEventListener=function(a,b){this._callbacks[a]=this._callbacks[a]||[],this._callbacks[a].push(b)},i.fire=function(a){for(var b=this._callbacks[a]||[],c=0,d=b.length;d>c;c++)b[c].apply(this)},i.bindInteractive=function(){function a(a){h.data&&(j=a.clientX+h._offsetX,k=a.clientY+h._offsetY,m=!0)}function c(a){m=!1}function d(a){m&&h.move(a.clientX-j,a.clientY-k,1)}function e(a){if(h.data){if(m)return!0;a.stopPropagation(),a.preventDefault();var b=-(a.detail?-120*a.detail:a.wheelDelta)/f.DEFAULT_WHEEL_FACTOR;return h.zoom(h._zoom+b,1),l=b,!1}}function g(a){return h.data?(a.stopPropagation(),a.preventDefault(),1==h._zoom?0==h._offsetX&&0==h._offsetY?h.fill():h.center():h.fit(),!1):void 0}var h=this,i=this.canvas,j=(i.getContext("2d"),0),k=0,l=0,m=!1;b(i,"mousedown",a),b(i,"mousemove",d),b(i,"mouseup",c),b(i,"mouseout",c),b(i,"dblclick",g),b(i,"mousewheel",e),b(i,"DOMMouseScroll",e)},i.unbindInteractive=function(){var a=this.canvas;c(a,"mousedown"),c(a,"mousemove"),c(a,"mouseup"),c(a,"mouseout"),c(a,"dblclick"),c(a,"mousewheel"),c(a,"DOMMouseScroll")},i.bindDroppable=function(){var a=this,c=this.canvas;"undefined"!=typeof FileReader&&(b(c,"drop",function(b){b.preventDefault();var c=b.dataTransfer.files;c.length>0&&a.handleFile(c[0])}),b(c,"dragover",function(a){a.preventDefault()}))},i.unbindDroppable=function(){var a=this.canvas;c(a,"dragover"),c(a,"drop")},i.bindSelectable=function(){var a=this,c=this.canvas;b(c,"click",function(c){if(!a.data){var d=document.createElement("input");d.type="file",d.style.visibility="hidden",document.body.appendChild(d);var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),e.synthetic=!0,b(d,"change",function(b){this.files&&this.files[0]&&a.handleFile(this.files[0]),d.parentNode&&document.body.removeChild(d)}),setTimeout(function(){d.parentNode&&document.body.removeChild(d)},2e4),d.dispatchEvent(e,!0)}})},i.unbindSelectable=function(){c(this.canvas,"click")},i.setLoadState=function(a){var b=this,c=Date.now(),d=16,e=this.canvas,f=e.width,h=e.height,i=e.getContext("2d");if(a){b._loading=!0,e.style.cursor="progress";var j=function(){g(function(){var a=parseInt((new Date-c)/1e3*d)/d;i.save(),i.clearRect(0,0,f,h),i.translate(f/2,h/2),i.rotate(2*Math.PI*a);for(var e=0;d>e;e++)i.beginPath(),i.rotate(2*Math.PI/d),i.moveTo(f/10,0),i.lineTo(f/4,0),i.lineWidth=f/30,i.strokeStyle="rgba(0, 0, 0,"+e/d+")",i.stroke();i.restore(),b._loading&&j()})};j()}else i.clearRect(0,0,f,h),e.style.cursor="default",delete this._loading},i.handleFile=function(a){if(-1!==a.type.indexOf("image")){var b=this,c=new FileReader;b.setLoadState(!0),b.canvas.style.cursor="progress",c.onload=function(a){b.setLoadState(!1),b.setSource(a.target.result)},c.onerror=function(){b.setLoadState(!1)},c.readAsDataURL(a)}},i.setSource=function(a){var b=this,c=this.canvas,d=new Image;b.setLoadState(!0),d.addEventListener("load",function(){b.fire("load"),b.setLoadState(!1),b.data=d,b.reset(),b.options.interactive?c.style.cursor="move":c.style.cursor="default"}),img.addEventListener("error",function(){b.setLoadState(!1)}),d.src=a},i.fit=function(a){return this.moveAndZoom(0,0,1,a||f.DEFAULT_ANIM_DURATE)},i.fill=function(a){if(this.data){var b=this.data,c=b.width,d=b.height;d>c?this.moveAndZoom(0,0,d/c,a||f.DEFAULT_ANIM_DURATE):this.moveAndZoom(0,0,c/d,a||f.DEFAULT_ANIM_DURATE)}return this},i.move=function(a,b,c){return this.moveAndZoom(a,b,this._zoom,c)},i.zoom=function(a,b){var c=-this._offsetX/this._zoom*a,d=-this._offsetY/this._zoom*a;return this.moveAndZoom(c,d,a,b)},i.moveAndZoom=function(a,b,c,d){function e(a,b,c){f._offsetX=a,f._offsetY=b,f._zoom=c,d&&f.render()}if(this.data){d=d||0,a=-a,b=-b;var f=this,h=this.options,i=Date.now(),j=i+d,k=this._zoom,l=this._offsetX,m=this._offsetY,n=c-k,o=a-l,p=b-m;if(c=Math.min(Math.max(c,h.minZoom),h.maxZoom),d&&1!==d){var q=function(){g(function(){var a=Date.now(),b=Math.min(a-i,d)/d,c=n*b,f=k+c,g=o*b,h=l+g,r=p*b,s=m+r;e(h,s,f),j>a&&q()},10)};q()}else e(a,b,c)}return this},i.reset=function(a){return"function"==typeof this[f.DEFAULT_MODE]&&this[f.DEFAULT_MODE].call(this,a),this},i.center=function(a){return this.moveAndZoom(0,0,this._zoom,a||f.DEFAULT_ANIM_DURATE)},i.clear=function(){this.filters=[],this._offsetX=0,this._offsetY=0,this._zoom=1,this.data=null;var a=this.canvas,b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),b.textAlign="center",b.fillText(this.options.message,a.width/2,a.height/2),this.options.selectable&&(a.style.cursor="pointer"),this.fire("clear")},i.render=function(){if(this.data){var a=this,b=this.data,c=this._zoom,d=this.canvas,e=d.getContext("2d"),f=b.width,g=b.height,h=f/g,i=this.filters;if(e.clearRect(0,0,d.width,d.height),1>h){var j=d.height*h;e.drawImage(b,0,0,f,g,(d.width-j*c)/2-this._offsetX,(d.height-d.height*c)/2-this._offsetY,j*c,d.height*c)}else{var k=d.width/h;e.drawImage(b,0,0,f,g,(d.width-d.width*c)/2-this._offsetX,(d.height-k*c)/2-this._offsetY,d.width*c,k*c)}for(var l=e.getImageData(0,0,d.width,d.height),m=0,n=i.length;n>m;m++)l=i[m].exec(this,l,d);e.putImageData(l,0,0),clearTimeout(a.fireTimeout),a.fireTimeout=setTimeout(function(){a.fire("change"),delete a.fireTimeout},250)}},i.save=function(){return this.data?this.canvas.toDataURL():void 0},i.hasFilter=function(a){for(var b=this.filters,c=0,d=b.length;d>c;c++)if(b[c].name==a)return!0;return!1},i.addFilter=function(a,b){if(this.hasFilter(a))return this;if("function"==typeof b)this.filters.push(new f.Filter(a,b));else if(f.filters[a]){var c=f.filters[a],d=new f.Filter(a,c.fn,c.defaults);b&&d.config(b),this.filters.push(d)}return this},i.removeFilter=function(a){var b=this.filters,c=0;for(b.length;c<b.length;c++)if(b[c].name==a)return this.filters.splice(c,1),this;return this},i.removeAllFilters=function(){return this.filters=[],this},i.updateFilter=function(a,b){var c=this.filters,d=0;for(c.length;d<c.length;d++)if(c[d].name==a)return c[d].config(b),this},"undefined"!=typeof module?module.exports=f:"function"==typeof define&&"object"==typeof define.amd?define(function(){return{AvatarCrop:f}}):window.AvatarCrop=f}(window);
//# sourceMappingURL=avatar-crop.min.js.map